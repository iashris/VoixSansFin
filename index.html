<!DOCTYPE html>
<html xmlns = "http://www.w3.org/1999/xhtml">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	
	<script src="inc/shim/Base64.js" type="text/javascript"></script>
	<script src="inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<script src="js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="js/midi/gm.js" type="text/javascript"></script>
	<script src="js/midi/loader.js" type="text/javascript"></script>
	<script src="js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<script src="js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="js/util/dom_request_script.js" type="text/javascript"></script>
<script   src="https://code.jquery.com/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css?family=Mrs+Sheppards|Cutive+Mono" rel="stylesheet">
<script type="text/javascript" src="jquery.xdomainajax.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
<div class="mainheading">
Voix Sans Fin
</div>
<p class="subtitle">The endless voice of irrational numbers<br>&lt;/iashris></p>
<div class="proceed" id="pro">Proceed</div>

</body>
<script type="text/javascript">
TBL='<table ><tbody><tr><td onclick="appear(this.innerHTML)" id="sym">&#960;</td><td onclick="appear(this.innerHTML)"  id="sym">&phi;</td><td onclick="appear(this.innerHTML)"  id="sym">e<sup>x</sup></td></tr><tr><td onclick="appear(this.innerHTML)"  id="sym">&tau;</td><td onclick="appear(this.innerHTML)" >custom</td><td onclick="appear(this.innerHTML)" >cos</td></tr><tr><td onclick="appear(this.innerHTML)" >\
log</td><td onclick="appear(this.innerHTML)" >sin</td><td onclick="appear(this.innerHTML)" >tan</td></tr></tbody></table>';

var code='<label for="exp">Irrational Entity</label>\
  <input type="text" name="exp" id="exp"><br>\
 <label for="dig">Digits</label>\
  <input type="text" name="dig" id="dig"><br>\
<button onclick="callwolfram();">begin</button>';

$('#pro').click(function(){
	$('body').fadeOut(function(){
		$('body').html("<div class='container'></div>");
		$('.container').html(TBL);
		$('body').fadeIn();
		
		});
	});

function appear(val) {
$('.container').fadeOut(function(){
		appear2(val);
	});
}



function appear2(val){
	plapausco=-1;
	velocity=100;
	muteco=-1;
	i=0;joker=0;
	valu=val;
func='';
arg='';
symb='';
	if(val=='sin' || val=='cos' || val=='tan'){
$('.container').html("<p class='appeartxt'>Play me <input type='text' value='100' id='digits'> digits of "+val+" <input type='text' value='60' id='arg'></p>");
func=val+' ';
instruarray=[ "xylophone", "choir_aahs","bird_tweet"];

}
else if(val=='log'){
$('.container').html("<p class='appeartxt'>Play me <input type='text' value='100' id='digits'> digits of "+val+" <input type='text' value='5' id='arg'></p>");
func=val+' ';
instruarray=[ "sitar", "seashore","bird_tweet"];
}
else if(val.startsWith('e')){
	$('.container').html("<p class='appeartxt'>Play me <input type='text' value='100' id='digits'> digits of e^<sup><input type='text' value='0.5' id='arg'></sup></p>");
	func='e^';
	instruarray=[ "acoustic_guitar_steel", "seashore","bird_tweet"];

}
else if(val=='custom'){
	$('.container').html("<p class='appeartxt'>Play me <input type='text' value='100' id='digits'> digits of <input type='text' value='pi^0.5' id='arg'></p>");
	instruarray=[ "acoustic_guitar_nylon", "whistle","bird_tweet"];
}
else{
$('.container').html("<p class='appeartxt'>Play me <input type='text' value='100' id='digits'> digits of "+val+'</p>');	
if(val=='π') symb='pi';
if(val=='τ') symb='pi/2';
if(val=='φ') symb='golden ratio';
instruarray=[ "acoustic_grand_piano","choir_aahs","bird_tweet"];

arg='';
}
$('.container').append('<div class="proceed" id="pro2" onclick="pro2();">Proceed</div>');
	$('.container').fadeIn();

}

function pro2(){
	digits=$('#digits').val();
	if(valu=='log' || valu=='sin' || valu=='cos' || valu=='tan' || valu=='custom'||valu.startsWith('e')){
		arg=$('#arg').val();
	}

	query=func+arg+symb;


	$('.container').fadeOut(function(){
		$('.container').html("<div class='displaydig'></div><div id='fixdiv'><div class='spa' id='mute' onclick='mute();'>Mute</div><div class='spa' onclick='reset();'>Reset</div></div>");
		
		$('.container').fadeIn(function(){
			$('.displaydig').html('Loading...');
			callwolfram();
		});

		});
	}


function callwolfram(){
	musique=-1;
	$.ajax({
	async:false,
    type: 'GET',
    url: "http://api.wolframalpha.com/v2/query?appid=K8XLWL-37R5K3XYQQ&input="+encodeURI(query+' '+digits+' digits')+"&format=plaintext",
    success: function (data) {
    	dump=data.responseText;
    	var firstoff=dump.substring(dump.indexOf('title="Result">'));
    	var portion=firstoff.substring(firstoff.indexOf('<plaintext>')+11,firstoff.indexOf('</plaintext'));
    	musique=portion;
    }
});
function waitForElement(){
    if(musique !== -1){

        beginmusic();
        
    }
    else{
        setTimeout(function(){
            waitForElement();
        },250);
    }
}
waitForElement();
}
chordarray=['none',['C4','E4','G4'],['D4','F4','A4'],['E4','G4','B4'],['F4','A4','C5'],['G4','B4','D5'],['A4','C5','E5'],['B4','D5','F5'],['C5','E5','G5'],['D5','F5','A5']];
notearray=['none','C5','D5','E5','F5','G5','A5','B5','C6','D6'];


function beginmusic(){

	MIDI.loadPlugin({
		soundfontUrl: "./soundfont/FluidR3_GM/",
		instruments: instruarray,
		onprogress: function(state, progress) {
		},
		onsuccess: function() {
			if (plapausco==-1)$('.displaydig').html('');
			howManyTimes = musique.length;
			intervals=[400,400,400,400,800,200,200,400,400,900];
			MIDI.programChange(0, MIDI.GM.byName[instruarray[0]].number);
			MIDI.programChange(1, MIDI.GM.byName[instruarray[1]].number);
			MIDI.programChange(2, MIDI.GM.byName[instruarray[2]].number);
			var delay = 0; // play one note every quarter second
			MIDI.setVolume(0, velocity);
			function f() {
			var note=MIDI.keyToNote[notearray[musique[i]]];
			
			MIDI.noteOn(0, note, velocity, delay);
			MIDI.noteOff(0, note, delay + 1.75);
			MIDI.noteOn(1, note, velocity/5, delay);
			MIDI.noteOff(1, note, delay + 1.75);
			
			MIDI.noteOn(2, MIDI.keyToNote[notearray[2]], parseInt(musique[i])?0:velocity*1.5, delay);
			MIDI.noteOff(2, MIDI.keyToNote[notearray[2]], delay + 2);
			
			$('.displaydig').append(musique[i]);
			$('#fixdiv').css({'visibility':'visible'});
			var left = $(document).outerWidth() - $(window).width();
			$('body, html').scrollLeft(left);
			$('#fixdiv').css({'left':left+$(window).width()/2.2});
   			i++;
    		if( i < howManyTimes && joker!=-1){
        		setTimeout( f, intervals[i%intervals.length] );
    							}

						}
			f();
		}
	});
}

function reset(){
	location.reload();
}
function mute(){
muteco++;
//if even, make it unmute
if(muteco%2==0){
$('#mute').html('Unmute');
velocity=0;
}
else{
	$('#mute').html('Mute');
velocity=100;
}
}
</script>

</html>